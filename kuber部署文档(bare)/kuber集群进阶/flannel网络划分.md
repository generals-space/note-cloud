# flannel网络划分

参考文章

1. [Kubernetes内的网络通信问题](http://julyclyde.org/?p=526)

一般的kuber集群网络都是172.17.0.0/16开始, 分配诸如172.17.28.0/24这样的网段. 这是因为默认的子网掩码为255.255.255.0, 只允许子网在172.17.28.x的范围中.

如果想限制子网数量与网段数量怎么做?

我希望flannel能划分的子网只能被限制在`172.17.28.xxxx 0000`中, 如`172.17.28.128/28`, 或是`172.17.28.0/28`, 又或是`172.17.28.192/28`等等. 这样docker容器的ip能变化的只有最后4位(如`172.17.28.1000 0001`, `172.17.28.1000 1000`等), 即子网掩码为28 , 单台服务器上只能启动10几个docker容器.

那etcd中存储的配置信息该怎么写?

`Network`表示了能够划分的子网范围, 还有一个与之同级的`SubnetLen`字段表示子网掩码, 也就是能代表单台服务器中容器的最大数量值.

```json
{
"Network": "172.17.28.0/24",
"SubnetLen": 28
}
```

这样, 每个flannel能够获得的网段都在`172.17.28.xxxx/28`中确定, 当某个flannel得到了`172.17.28.1100/28`, 即`172.17.28.192/28`网段时, 它就可以为自己的docker分配`172.17.28.1100 xxxx`的ip了.